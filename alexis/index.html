<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TiroScore</title>
  <style>
    :root{
      --bg:#071022; --card:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --glass:rgba(255,255,255,0.03);
      --gap:12px; --radius:10px;
      --range-corta:#10b981;   /* verde */
      --range-media:#f59e0b;   /* amarillo/ámbar */
      --range-larga:#ef4444;   /* rojo */
    }
    /* Mobile-first layout */
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#071121 0%,#081827 100%);color:#e6eef6;padding:16px}
    .wrap{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
    .profile{display:flex;align-items:center;gap:12px}
    .avatar{width:44px;height:44px;border-radius:999px;background:linear-gradient(180deg,#0ea5a3,#06b6d4);display:flex;align-items:center;justify-content:center;color:#042;font-weight:700}
    h1{font-size:16px;margin:0}
    .meta{font-size:13px;color:var(--muted)}
    /* responsive grid: stacks on mobile, columns on larger */
    .grid{display:grid;grid-template-columns:1fr;gap:var(--gap);margin-bottom:14px}
    .card{background:var(--card);padding:12px;border-radius:var(--radius);box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .kpi{font-size:22px;font-weight:700}
    .muted{color:var(--muted);font-size:13px}

    /* table responsiveness and visuals */
    .tableScroll{width:100%;overflow:auto;-webkit-overflow-scrolling:touch}
    table{width:100%;border-collapse:collapse;margin-top:8px;min-width:760px}
    th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03)}
    .right{text-align:right}
    .center{text-align:center}

    /* replace colored row/bg approach with small colored dot for distance */
    .distDot{width:14px;height:14px;border-radius:50%;display:inline-block;vertical-align:middle;margin-right:8px;box-shadow:0 0 0 2px rgba(0,0,0,0.35)}
    .dist-corta{background:var(--range-corta)}
    .dist-media{background:var(--range-media)}
    .dist-larga{background:var(--range-larga)}

    /* keep range pills styled */
    .pill.range-corta { background: rgba(16,185,129,0.12); border:1px solid rgba(16,185,129,0.18); color: #dffaf0; }
    .pill.range-media { background: rgba(245,158,11,0.12); border:1px solid rgba(245,158,11,0.18); color: #fff7e6; }
    .pill.range-larga { background: rgba(239,68,68,0.12); border:1px solid rgba(239,68,68,0.18); color: #ffecec; }

    /* animal image and surface dot */
    .animalImg{width:52px;height:52px;border-radius:50%;object-fit:cover;margin-left:8px;border:2px solid rgba(255,255,255,0.06)}
    @media(max-width:420px){ .animalImg{width:52px;height:52px} table{min-width:680px} }

    /* make superficie column wider visually */
    th.surfaceCol, td.surfaceCol{min-width:140px;max-width:260px}

    /* Nuevo: estilos para gráfico de barras horizontal */
    .scoreChart{display:flex;flex-direction:column;gap:10px;margin-top:8px}
    .scoreRow{display:flex;align-items:center;gap:10px}
    .scoreLabel{width:36px;font-weight:700;color:var(--muted);text-align:right}
    .scoreBarBg{flex:1;height:14px;background:rgba(255,255,255,0.03);border-radius:999px;overflow:hidden;display:flex;align-items:center}
    .scoreBar{height:100%;border-radius:999px 0 0 999px;transition:width .45s ease}
    .scoreValue{width:84px;text-align:right;color:var(--muted);font-size:13px}

    /* colores para cada puntaje (puedes ajustar) */
    .scoreBar.m{background:linear-gradient(90deg,#ef4444,#fb7185)}   /* M - rojo */
    .scoreBar['5']{background:linear-gradient(90deg,#f59e0b,#fbbf24)}
    .scoreBar._5{background:linear-gradient(90deg,#f59e0b,#fbbf24)}
    .scoreBar._8{background:linear-gradient(90deg,#06b6d4,#7dd3fc)}
    .scoreBar._10{background:linear-gradient(90deg,#60a5fa,#3b82f6)}
    .scoreBar._11{background:linear-gradient(90deg,#34d399,#10b981)}

    /* Animal grid (3 filas x 4 columnas) */
    .animalGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:18px}
    @media(max-width:900px){ .animalGrid{grid-template-columns:repeat(2,1fr)} }
    @media(max-width:520px){ .animalGrid{grid-template-columns:repeat(1,1fr)} }

    .animalCard{background:var(--card);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:center;box-shadow:0 6px 18px rgba(2,6,23,0.4)}
    .animalThumb{width:64px;height:64px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.04)}
    .animalInfo{flex:1;display:flex;flex-direction:column;gap:6px}
    .animalName{font-weight:800;font-size:15px}
    .shots{display:flex;gap:8px;flex-wrap:wrap}
    .shotBadge{min-width:28px;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03);text-align:center;font-weight:700}
    .shotBadge.m{background:rgba(255,255,255,0.04);color:var(--muted)}
    .shotBadge.num{background:linear-gradient(90deg,rgba(6,182,212,0.12),rgba(96,165,250,0.06));color:var(--accent)}

    /* NEW: line chart comparando puntaje perfecto vs puntaje obtenido */
    .card#scoreLineCard {
      background: var(--card);
      padding: 12px;
      border-radius: var(--radius);
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      margin-top: 16px;
    }
    #scoreLineSvg {
      width: 100%;
      height: 220px;
    }
    #scoreLineLegend {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 8px;
    }
    .chartPoint {
      fill: var(--accent);
      stroke: #00000011;
      stroke-width: 0.5;
    }
    .chartPerf {
      fill: transparent;
      stroke: rgba(255,255,255,0.15);
      stroke-width: 2;
      stroke-dasharray: 6 4;
    }
    .shotThumb {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255,255,255,0.04);
      background: rgba(255,255,255,0.02);
    }
    .shotItem {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      min-width: 48px;
    }
    .shotLabel {
      font-size: 11px;
      color: var(--muted);
      text-align: center;
    }

    /* legend color swatches */
    .legendRow{display:flex;gap:12px;align-items:center;margin-left:8px}
    .legendItem{display:flex;gap:8px;align-items:center;font-size:13px;color:var(--muted)}
    .legendSwatch{width:12px;height:12px;border-radius:3px;display:inline-block;box-shadow:0 0 0 1px rgba(0,0,0,0.15)}
    .sw-M{background:#ef4444}     /* M - rojo */
    .sw-5{background:#f59e0b}     /* 5 - ámbar */
    .sw-8{background:#06b6d4}     /* 8 - celeste */
    .sw-10{background:#60a5fa}    /* 10 - violeta/azul */
    .sw-11{background:#34d399}    /* 11 - verde */
  </style>
</head>
<body>
   
  <div class="wrap">
    <header>
      <div style="display:flex;align-items:center;gap:12px">
        <div class="profile">
          <div class="avatar">AY</div>
          <div>
            <h1 id="arqueroName">Alexis Yardbullier</h1>
            <div class="meta">Arquero · Arquería Pinamar CET · 3D</div>
          </div>
        </div>
      </div>
      <!-- botón de descarga eliminado -->
    </header>

    <div class="grid" id="kpis">
      <div class="card">
        <div class="muted">Intentos totales</div>
        <div class="kpi" id="kpiAttempts">—</div>
      </div>
      <div class="card">
        <div class="muted">Puntos totales</div>
        <div class="kpi" id="kpiPoints">—</div>
      </div>
      <div class="card">
        <div class="muted">Veces con 'MM'</div>
        <div class="kpi" id="kpiDobleM">—</div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="muted">Distribución de puntajes (por cantidad)</div>

        <!-- reemplazo: contenedor para gráfico de barras -->
        <div id="bars" class="scoreChart" aria-hidden="false"></div>
        <div id="labels" style="margin-top:8px;display:flex;justify-content:space-between;font-size:13px;color:var(--muted)"></div>

      
      </div>

      <div class="card">
        <div class="muted">Detalle por puntaje</div>
        <table id="puntajeTable" aria-describedby="Detalle puntajes">
          <thead>
            <tr><th>Puntaje</th><th>Cantidad</th><th>% de disparos</th><th>Puntos totales</th><th>% de puntos</th></tr>
          </thead>
          <tbody></tbody>
        </table>

        <div id="puntajeSummary" class="summary" aria-hidden="false">
          <div>
            <div class="muted">Total de puntos</div>
            <div id="sumTotalPoints" style="font-size:18px;font-weight:800;color:var(--accent)">—</div>
          </div>
          <div>
            <div class="muted">Total 10 (veces)</div>
            <div id="sumTotal10" style="font-size:16px;font-weight:800">—</div>
          </div>
          <div>
            <div class="muted">Total 11 (veces)</div>
            <div id="sumTotal11" style="font-size:16px;font-weight:800">—</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="muted">Rangos de distancia</div>
        <div class="pill" id="rangosText" style="margin-top:8px"></div>
        <div style="margin-top:10px" class="muted">Estaciones por rango</div>
        <div id="rangosList" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap"></div>

        <!-- NUEVO: Estaciones por altura -->
        <div style="margin-top:10px" class="muted">Estaciones por altura</div>
        <div id="estacionesAlturaList" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap"></div>

        <!-- nota: la sección de 'Estaciones con MM' fue MOVIDA arriba (debajo del gráfico) -->
      </div>
    </div>

    <!-- Planilla -->
    <div class="card sheet" style="margin-top:14px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="muted">Planilla de disparos</div>
          <div class="meta">Resumen por estación — 24 disparos (2 vueltas)</div>
        </div>
        <div class="meta">Intentos: <span id="metaAttempts">-</span> · Puntos: <span id="metaPoints">-</span></div>
      </div>

      <div class="tableScroll">
        <table id="sheetTable" style="margin-top:10px">
          <thead>
            <tr>
              <th style="width:88px">N°</th>
              <th style="width:260px">Animal</th>
              <th class="surfaceCol">Superf.</th>
              <th style="width:78px;text-align:center">Dist (m)</th>
              <th>Altura</th>
              <th style="width:64px">Disp. 1</th>
              <th style="width:64px">Disp. 2</th>
              <th style="width:78px">Total est.</th>
              <th style="width:96px">Acumulado</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- ADICION: distribuciones solicitadas -->
      <div id="distribuciones" style="margin-top:14px;display:grid;grid-template-columns:1fr;gap:12px">
        <div class="card" id="distByRangeCard">
          <div class="muted">Distribución por rango de distancia</div>
          <div style="overflow:auto;margin-top:8px">
            <table id="distRangeTable" style="min-width:320px">
              <thead>
                <tr><th>Puntaje</th><th>Corta</th><th>Media</th><th>Larga</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card" id="distByAlturaCard">
          <div class="muted">Distribución por altura (Alta / Plana / Baja)</div>
          <div style="overflow:auto;margin-top:8px">
            <table id="alturaTable" style="min-width:320px">
              <thead>
                <tr><th>Puntaje</th><th>Alta</th><th>Plana</th><th>Baja</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <div class="muted">Lista de puntajes</div>
        <div id="puntajePills" style="display:flex;gap:8px;flex-wrap:wrap"></div>
      </div>
    </div>

    <footer style="margin-top:14px" id="metaFooter"></footer>

    <!-- NEW: grilla de desempeño por animal (12 estaciones -> 12 animales) -->
    <div id="animalGrid" class="animalGrid" aria-live="polite"></div>

    <!-- NEW: resumen de desempeño (positivo + mejoras) -->
    <div id="performanceSummary" class="card" style="margin-top:16px">
      <div id="positiveSummary" style="font-weight:700"></div>
      <div id="improveSummary" style="margin-top:8px;color:var(--muted)"></div>
      <div id="vueltaSummary" style="margin-top:8px;color:var(--muted)"></div>
    </div>

    <!-- NEW: line chart comparando puntaje perfecto vs puntaje obtenido -->
    <div class="card" id="scoreLineCard" style="margin-top:16px;padding:12px">
      <div class="muted">Evolución acumulada — Puntaje perfecto vs obtenido</div>
      <div id="scoreLineWrap" style="margin-top:10px">
        <!-- AGRANDADO: svg más amplio y alto para mejor visualización -->
        <svg id="scoreLineSvg" viewBox="0 0 1200 340" preserveAspectRatio="xMidYMid meet" style="width:100%;height:320px"></svg>
        <div id="scoreLineLegend" style="display:flex;gap:12px;align-items:center;margin-top:8px">
          <div style="display:flex;gap:8px;align-items:center"><span style="width:12px;height:8px;background:rgba(255,255,255,0.15);display:inline-block;border-radius:2px"></span><small style="color:var(--muted)">Perfecto (11/tiro)</small></div>
          <div style="display:flex;gap:8px;align-items:center"><span style="width:12px;height:8px;background:var(--accent);display:inline-block;border-radius:2px"></span><small style="color:var(--muted)">Obtenido</small></div>

          <!-- Nuevo: leyenda de colores por valor de disparo -->
          <div class="legendRow" aria-hidden="false">
            <div class="legendItem"><span class="legendSwatch sw-M" aria-hidden="true"></span><small>M</small></div>
            <div class="legendItem"><span class="legendSwatch sw-5" aria-hidden="true"></span><small>5 pts</small></div>
            <div class="legendItem"><span class="legendSwatch sw-8" aria-hidden="true"></span><small>8 pts</small></div>
            <div class="legendItem"><span class="legendSwatch sw-10" aria-hidden="true"></span><small>10 pts</small></div>
            <div class="legendItem"><span class="legendSwatch sw-11" aria-hidden="true"></span><small>11 pts</small></div>
          </div>
        </div>

        <!-- REMOVIDO: strip con la imagen del animal y número de estaca -->
      </div>
    </div>

    <style>
      /* small styles for the line chart markers */
      .chartPoint{fill:var(--accent);stroke:#00000011;stroke-width:0.5}
      .chartPerf{fill:transparent;stroke:rgba(255,255,255,0.15);stroke-width:2;stroke-dasharray:6 4}
      .shotThumb{width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02)}
      .shotItem{display:flex;flex-direction:column;align-items:center;gap:4px;min-width:48px}
      .shotLabel{font-size:11px;color:var(--muted);text-align:center}

      /* legend color swatches */
      .legendRow{display:flex;gap:12px;align-items:center;margin-left:8px}
      .legendItem{display:flex;gap:8px;align-items:center;font-size:13px;color:var(--muted)}
      .legendSwatch{width:12px;height:12px;border-radius:3px;display:inline-block;box-shadow:0 0 0 1px rgba(0,0,0,0.15)}
      .sw-M{background:#ef4444}     /* M - rojo */
      .sw-5{background:#f59e0b}     /* 5 - ámbar */
      .sw-8{background:#06b6d4}     /* 8 - celeste */
      .sw-10{background:#60a5fa}    /* 10 - violeta/azul */
      .sw-11{background:#34d399}    /* 11 - verde */
    </style>

  </div> <!-- /.wrap -->

  <script type="module">
    import tiroData from './index.js';

    const el = (tag, cls, txt) => { const e=document.createElement(tag); if(cls) e.className=cls; if(txt!==undefined) e.textContent=txt; return e; };

    // KPIs
    document.getElementById('kpiAttempts').textContent = tiroData.totalAttempts ?? 0;
    document.getElementById('kpiPoints').textContent = tiroData.totalPoints ?? 0;
    document.getElementById('kpiDobleM').textContent = (tiroData.dobleMCount ?? 0);

    // --- REEMPLAZADO: render del gráfico de distribución por puntajes (barra de progreso) ---
    const scoreKeys = ['M','5','8','10','11'];
    const counts = {
      M: tiroData.puntajeM?.cantidad ?? 0,
      5: tiroData.puntaje5?.cantidad ?? 0,
      8: tiroData.puntaje8?.cantidad ?? 0,
      10: tiroData.puntaje10?.cantidad ?? 0,
      11: tiroData.puntaje11?.cantidad ?? 0
    };

    (function renderScoreChart(){
      const chart = document.getElementById('bars');
      const labels = document.getElementById('labels');
      if (!chart) return;
      chart.innerHTML = '';
      if (labels) labels.innerHTML = '';

      const total = Object.values(counts).reduce((a,b)=>a+b,0) || 1;
      const maxCount = Math.max(...Object.values(counts),1);

      const clsFor = k => {
        if (k === 'M') return 'm';
        if (k === '5') return '_5';
        if (k === '8') return '_8';
        if (k === '10') return '_10';
        return '_11';
      };

      scoreKeys.forEach(k=>{
        const count = counts[k] || 0;
        const pctOfTotal = ((count/total)*100).toFixed(1);
        const pctOfMax = Math.max(2, ((count/maxCount)*100)); // visual width
        const cls = clsFor(k);

        const row = document.createElement('div');
        row.className = 'scoreRow';
        row.innerHTML = `
          <div class="scoreLabel">${k}</div>
          <div class="scoreBarBg"><div class="scoreBar ${cls}" style="width:${pctOfMax}%;"></div></div>
          <div class="scoreValue">${count} (${pctOfTotal}%)</div>
        `;
        chart.appendChild(row);

        if (labels) labels.appendChild(el('div','',''));
      });
    })();

    // Puntaje table
    const tbody = document.querySelector('#puntajeTable tbody');
    function addRow(name, obj){
      const cantidad = obj.cantidad ?? 0;
      const total = obj.total ?? (cantidad * (name === 'M' ? 0 : Number(name)));
      const porcentajeDisparos = obj.porcentaje ?? obj.porcentajeDisparos ?? (tiroData.totalAttempts ? parseFloat(((cantidad/tiroData.totalAttempts)*100).toFixed(2)) : 0);
      const porcentajePuntos = obj.porcentajePuntos ?? (tiroData.totalPoints ? parseFloat(((total/(tiroData.totalPoints))*100).toFixed(2)) : 0);
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${name}</td><td>${cantidad}</td><td>${porcentajeDisparos}%</td><td>${total}</td><td>${porcentajePuntos}%</td>`;
      tbody.appendChild(tr);
    }
    addRow('M', tiroData.puntajeM);
    addRow('5', tiroData.puntaje5);
    addRow('8', tiroData.puntaje8);
    addRow('10', tiroData.puntaje10);
    addRow('11', tiroData.puntaje11);

    // summary blocks (uses counts for 10/11, not total points)
    document.getElementById('sumTotalPoints').textContent = tiroData.totalPoints ?? 0;
    const total10Count = (tiroData.puntaje10 && (tiroData.puntaje10.cantidad ?? 0)) || 0;
    const total11Count = (tiroData.puntaje11 && (tiroData.puntaje11.cantidad ?? 0)) || 0;
    document.getElementById('sumTotal10').textContent = total10Count;
    document.getElementById('sumTotal11').textContent = total11Count;

    // Rangos & doble M
    (function renderRangosAndDobleM() {
      // obtener referencias a los elementos del DOM (puede que no existan en pruebas)
      const rangosTextEl = document.getElementById('rangosText');
      const rList = document.getElementById('rangosList');
      const alturaListEl = document.getElementById('estacionesAlturaList');
      const dm = document.getElementById('dobleM');

      const [cMin,cMax] = tiroData.distanciaCorta ?? [null,null];
      const [mMin,mMax] = tiroData.distanciaMedia ?? [null,null];
      const [lMin,lMax] = tiroData.distanciaLarga ?? [null,null];

      if (rangosTextEl) {
        rangosTextEl.textContent =
          `Corta: ${cMin} - ${cMax} | Media: ${mMin} - ${mMax} | Larga: ${lMin} - ${lMax}`;
      }

      // pills de estaciones por rango (si existe el contenedor)
      if (rList) {
        rList.innerHTML = '';
        const pillC = el('div','pill range-corta','Corta: ' + ((tiroData.estacionesCorta||[]).join(', ') || '—'));
        const pillM = el('div','pill range-media','Media: ' + ((tiroData.estacionesMedia||[]).join(', ') || '—'));
        const pillL = el('div','pill range-larga','Larga: ' + ((tiroData.estacionesLarga||[]).join(', ') || '—'));
        rList.appendChild(pillC);
        rList.appendChild(pillM);
        rList.appendChild(pillL);
      }

      // Estaciones por altura (si existe el contenedor)
      if (alturaListEl) {
        alturaListEl.innerHTML = '';
        const altas = [], medias = [], bajas = [];
        const estacionesObj = tiroData.estaciones || {};
        Object.entries(estacionesObj).forEach(([id, meta]) => {
          const h = (meta && meta.altura || '').toString().toLowerCase();
          if (h === 'alto' || h === 'alta') altas.push(id);
          else if (h === 'medio' || h === 'plana') medias.push(id);
          else bajas.push(id);
        });
        alturaListEl.appendChild(el('div','pill','Altas: ' + (altas.join(', ') || '—')));
        alturaListEl.appendChild(el('div','pill','Medias: ' + (medias.join(', ') || '—')));
        alturaListEl.appendChild(el('div','pill','Bajas: ' + (bajas.join(', ') || '—')));
      }

      // estaciones con doble M (si existe el contenedor)
      if (dm) {
        dm.innerHTML = '';
        dm.appendChild(el('div','pill', (tiroData.estacionesDobleM && tiroData.estacionesDobleM.length) ? tiroData.estacionesDobleM.join(', ') : '—'));
      }
     })();

    // Planilla rows: construir usando la propiedad `estacion` dentro de cada entrada de `arquero`
    // (primera vuelta entries 1..12 arrancan en estaca 10 según index.js; segunda vuelta 13..24 repiten)
    const sheetTbody = document.querySelector('#sheetTable tbody');
    let acumulado = 0;
    const safeVal = v => (v === 'M' ? 0 : (Number(v) || 0));
    const estacionesObj = tiroData.estaciones || {};
    const keys = Object.keys(tiroData.arquero).map(k => Number(k)).sort((a,b) => a - b);

    // prepare range bounds once for row rendering
    const [rowCMin,rowCMax] = tiroData.distanciaCorta ?? [null,null];
    const [rowMMin,rowMMax] = tiroData.distanciaMedia ?? [null,null];
    const [rowLMin,rowLMax] = tiroData.distanciaLarga ?? [null,null];

    // <-- AÑADIDO: función para obtener la clave de rango (corta/media/larga)
    const getRangeKeyRow = (dist) => {
      if (dist === null || dist === undefined) return null;
      const d = Number(dist);
      if (!Number.isFinite(d)) return null;
      if (rowCMin !== null && rowCMax !== null && d >= rowCMin && d < rowCMax) return 'corta';
      // CORRECCIÓN: usar las variables correctas rowMMin/rowMMax y rowLMin/rowLMax
      if (rowMMin !== null && rowMMax !== null && d >= rowMMin && d < rowMMax) return 'media';
      if (rowLMin !== null && rowLMax !== null && d >= rowLMin && d <= rowLMax) return 'larga';
      return null;
    };
    
    keys.forEach(keyNum => {
      const entry = tiroData.arquero[keyNum] || {};
      const d1 = entry.disparo1 !== undefined ? entry.disparo1 : '-';
      const d2 = entry.disparo2 !== undefined ? entry.disparo2 : '-';
      const totEst = safeVal(d1) + safeVal(d2);
      acumulado += totEst;

      // usar la estación tal como figura en el objeto arquero (campo `estacion`)
      const estacionFisica = Number(entry.estacion) || (((keyNum - 1) % 12) + 1);
      const vuelta = keyNum <= 12 ? 1 : 2;
      const estMeta = estacionesObj[estacionFisica] || {};

      // animal / superficie
      const animalTipo = estMeta.animal && estMeta.animal.tipo ? String(estMeta.animal.tipo) : '';
      const superficieRaw = estMeta.animal && estMeta.animal.superficie ? String(estMeta.animal.superficie).toLowerCase() : '';
      let sizeClass = 'medium';
      if (superficieRaw === 'grande') sizeClass = 'large';
      else if (superficieRaw === 'chica') sizeClass = 'small';
      const superficieLabel = superficieRaw || '—';

      // altura arrow
      const alturaRaw = (estMeta.altura || '').toString().toLowerCase();
      let arrowChar = '→', arrowClass = 'right';
      if (alturaRaw === 'bajo' || alturaRaw === 'baja') { arrowChar = '↓'; arrowClass = 'down'; }
      else if (alturaRaw === 'alto' || alturaRaw === 'alta') { arrowChar = '↑'; arrowClass = 'up'; }

      // animal image (img/animal/{name}.png)
      const animalFile = animalTipo ? encodeURIComponent(animalTipo.toLowerCase()) : '';
      const imgHtml = animalFile
        ? `<img class="animalImg" src="../img/animal/${animalFile}.png" alt="${animalTipo}" onerror="this.style.display='none'">`
        : `<div style="width:52px;height:52px;border-radius:50%;background:rgba(255,255,255,0.02)"></div>`;

      // rango de distancia para el punto coloreado
      const rangeKey = getRangeKeyRow ? getRangeKeyRow(estMeta.distancia) : null;
      const distDotClass = rangeKey ? `dist-${rangeKey}` : '';
      const distanciaDisplay = estMeta.distancia ?? '—';

      const tr = document.createElement('tr');
      tr.innerHTML =
        `<td>${keyNum} <div style="color:var(--muted);font-size:11px">S${estacionFisica}·V${vuelta}</div></td>` +
        `<td style="display:flex;align-items:center;gap:10px">${imgHtml}<div style="display:flex;flex-direction:column;justify-content:center"><div style="font-weight:700">${animalTipo || '—'}</div></div></td>` +
        `<td class="surfaceCol">${'<span class="dot '+sizeClass+'" title="'+superficieLabel+'" style="width:'+ (sizeClass==='large'?20:(sizeClass==='small'?8:14)) +'px;height:'+ (sizeClass==='large'?20:(sizeClass==='small'?8:14)) +'px;background:'+(sizeClass==='large'?'#34d399':(sizeClass==='small'?'#60a5fa':'#06b6d4'))+';display:inline-block;border-radius:50%;margin-right:8px;vertical-align:middle"></span>'}${superficieLabel}</td>` +
        `<td class="center"><span class="distDot ${distDotClass}" title="Rango: ${rangeKey ?? '—'}"></span><span style="font-weight:700">${distanciaDisplay}</span></td>` +
        `<td>${estMeta.altura ?? '—'} <span class="arrow ${arrowClass}">${arrowChar}</span></td>` +
        `<td>${d1}</td><td>${d2}</td>` +
        `<td class="right">${totEst}</td><td class="right">${acumulado}</td>`;
      sheetTbody.appendChild(tr);
    });

    // Insert summary rows into planilla BEFORE the pills area
    const makeSummaryRow = (label, value) => {
      const tr = document.createElement('tr');
      tr.innerHTML =
        `<td colspan="3" style="font-weight:800;font-size:14px">${label}</td>` +
        `<td colspan="2"></td>` +
        `<td style="font-weight:900;color:var(--accent);text-align:right">${value}</td>` +
        `<td></td>`;
      return tr;
    };
    const sheetTotalPoints = tiroData.totalPoints ?? 0;
    sheetTbody.appendChild(makeSummaryRow('TOTAL DE PUNTOS', sheetTotalPoints));
    sheetTbody.appendChild(makeSummaryRow('TOTAL 10 (veces)', total10Count));
    sheetTbody.appendChild(makeSummaryRow('TOTAL 11 (veces)', total11Count));

    // --- NUEVO: Distribuciones por rango y por altura (con % por columna) ---
    (function renderDistribuciones() {
      const scores = ['M','5','8','10','11'];

      // prepare counters
      const ranges = { corta: {}, media: {}, larga: {} };
      const alturas = { alta: {}, plana: {}, baja: {} };
      scores.forEach(s => {
        ranges.corta[s]=0; ranges.media[s]=0; ranges.larga[s]=0;
        alturas.alta[s]=0; alturas.plana[s]=0; alturas.baja[s]=0;
      });

      // distance boundaries from tiroData (arrays [min, max])
      const [cMin,cMax] = tiroData.distanciaCorta ?? [null,null];
      const [mMin,mMax] = tiroData.distanciaMedia ?? [null,null];
      const [lMin,lMax] = tiroData.distanciaLarga ?? [null,null];

      const getRangeKey = (dist) => {
        if (dist === null || dist === undefined) return null;
        const d = Number(dist);
        if (!Number.isFinite(d)) return null;
        if (d >= cMin && d < cMax) return 'corta';
        if (d >= mMin && d < mMax) return 'media';
        if (d >= lMin && d <= lMax) return 'larga';
        return 'larga';
      };

      // iterate shots (1..24) using object order keys
      Object.keys(tiroData.arquero).map(k=>Number(k)).sort((a,b)=>a-b).forEach(n=>{
        const entry = tiroData.arquero[n] || {};
        // map to physical station 1..12
        const estacionFisica = ((n - 1) % 12) + 1;
        const meta = tiroData.estaciones && tiroData.estaciones[estacionFisica] ? tiroData.estaciones[estacionFisica] : {};
        const dist = meta.distancia;
        const rawAlt = (meta.altura || '').toString().toLowerCase();
        // normalize altura -> alta / plana / baja
        const alturaKey = rawAlt === 'alto' ? 'alta' : (rawAlt === 'medio' ? 'plana' : 'baja');

        const shots = [entry.disparo1, entry.disparo2];
        shots.forEach(sh => {
          const s = (sh === undefined || sh === null) ? null : String(sh);
          if (s === null) return;
          const range = getRangeKey(dist);
          if (range) ranges[range][s] = (ranges[range][s]||0)+1;
          alturas[alturaKey][s] = (alturas[alturaKey][s]||0)+1;
        });
      });

      // totales por columna (para calcular %)
      const totalRangeCounts = {
        corta: Object.values(ranges.corta).reduce((a,b)=>a+b,0),
        media: Object.values(ranges.media).reduce((a,b)=>a+b,0),
        larga: Object.values(ranges.larga).reduce((a,b)=>a+b,0)
      };
      const totalAltCounts = {
        alta: Object.values(alturas.alta).reduce((a,b)=>a+b,0),
        plana: Object.values(alturas.plana).reduce((a,b)=>a+b,0),
        baja: Object.values(alturas.baja).reduce((a,b)=>a+b,0)
      };

      // render helpers: mostrar "count (pct%)"
      const cellText = (count, total) => {
        const pct = total > 0 ? ((count/total)*100).toFixed(1) : '0.0';
        return `${count} (${pct}%)`;
      };

      // render tables
      const distBody = document.querySelector('#distRangeTable tbody');
      const alturaBody = document.querySelector('#alturaTable tbody');
      // clear existing
      distBody.innerHTML = '';
      alturaBody.innerHTML = '';

      scores.forEach(score=>{
        const cortaCount = ranges.corta[score] || 0;
        const mediaCount = ranges.media[score] || 0;
        const largaCount = ranges.larga[score] || 0;
        const trR = document.createElement('tr');
        trR.innerHTML = `<td>${score}</td><td>${cellText(cortaCount, totalRangeCounts.corta)}</td><td>${cellText(mediaCount, totalRangeCounts.media)}</td><td>${cellText(largaCount, totalRangeCounts.larga)}</td>`;
        distBody.appendChild(trR);

        const altaCount = alturas.alta[score] || 0;
        const planaCount = alturas.plana[score] || 0;
        const bajaCount = alturas.baja[score] || 0;
        const trA = document.createElement('tr');
        trA.innerHTML = `<td>${score}</td><td>${cellText(altaCount, totalAltCounts.alta)}</td><td>${cellText(planaCount, totalAltCounts.plana)}</td><td>${cellText(bajaCount, totalAltCounts.baja)}</td>`;
        alturaBody.appendChild(trA);
      });
    })();
    // --- fin distribuciones ---

    // fill pills list
    document.getElementById('metaAttempts').textContent = tiroData.totalAttempts ?? 0;
    document.getElementById('metaPoints').textContent = tiroData.totalPoints ?? 0;

    const puntajePills = document.getElementById('puntajePills');
    const pts = [
      { label:'M', obj: tiroData.puntajeM },
      { label:'5', obj: tiroData.puntaje5 },
      { label:'8', obj: tiroData.puntaje8 },
      { label:'10', obj: tiroData.puntaje10 },
      { label:'11', obj: tiroData.puntaje11 }
    ];
    pts.forEach(p=>{
      const cantidad = p.obj.cantidad ?? 0;
      const total = p.obj.total ?? (cantidad * (p.label === 'M' ? 0 : Number(p.label)));
      puntajePills.appendChild(el('div','pill', `${p.label} — ${cantidad} · pts: ${total}`));
    });

    // footer meta
    document.getElementById('metaFooter').textContent = `Distancia mínima: ${tiroData.distanciaMinima} — Distancia máxima: ${tiroData.distanciaMaxima}`;

    // --- NUEVO: renderizar grilla de animales con 4 disparos por animal ---
    // --- REEMPLAZADO: animal card ahora incluye número de estación en letra más pequeña junto al nombre ---
    (function renderAnimalGrid() {
      const container = document.getElementById('animalGrid');
      if (!container) return;
      container.innerHTML = '';
      const estaciones = tiroData.estaciones || {};
      // recorrer estaciones físicas 1..12
      for (let sid = 1; sid <= 12; sid++) {
        const meta = estaciones[sid] || {};
        const animalTipo = meta.animal && meta.animal.tipo ? String(meta.animal.tipo) : '—';
        const animalFile = animalTipo && animalTipo !== '—' ? encodeURIComponent(animalTipo.toLowerCase()) : '';
        const imgSrc = animalFile ? `../img/animal/${animalFile}.png` : '';
        // buscar en arquero las entradas que correspondan a esta estación (puede aparecer en primera y segunda vuelta)
        const entradas = Object.entries(tiroData.arquero || {})
          .filter(([k, e]) => Number(e && e.estacion) === sid)
          .sort((a,b)=> Number(a[0]) - Number(b[0]));
        // construir array de hasta 4 disparos (orden: primera entrada disparo1, disparo2, segunda entrada disparo1, disparo2)
        const shots = [];
        entradas.forEach(([k, e]) => {
          shots.push(e.disparo1 !== undefined ? e.disparo1 : '-');
          shots.push(e.disparo2 !== undefined ? e.disparo2 : '-');
        });
        while (shots.length < 4) shots.push('-');

        const card = document.createElement('div');
        card.className = 'animalCard';
        card.innerHTML = `
          <img class="animalThumb" src="${imgSrc}" alt="${animalTipo}" onerror="this.style.display='none'">
          <div class="animalInfo">
            <div>
              <div class="animalName">${animalTipo}</div>
              <div style="font-size:12px;color:var(--muted);margin-top:4px">Estación ${sid}</div>
            </div>
            <div class="shots" aria-label="Disparos">${shots.map(s => {
              const cls = (s === 'M' || s === 'm') ? 'm' : 'num';
              return `<div class="shotBadge ${cls}">${s}</div>`;
            }).join('')}</div>
          </div>
        `;
        container.appendChild(card);
      }
    })();

    // --- NUEVO: generar textos resumidos basados en estadísticas ---
    (function renderPerformanceSummary(){
      const positiveEl = document.getElementById('positiveSummary');
      const improveEl = document.getElementById('improveSummary');
      const vueltaEl = document.getElementById('vueltaSummary');
      if (!positiveEl || !improveEl) return;

      // Totales básicos
      // avoid mixing '??' and '||' which causes a syntax error — compute fallback sum directly
      const totalAttempts = tiroData.totalAttempts ?? (
        (tiroData.puntajeM?.cantidad ?? 0) +
        (tiroData.puntaje5?.cantidad ?? 0) +
        (tiroData.puntaje8?.cantidad ?? 0) +
        (tiroData.puntaje10?.cantidad ?? 0) +
        (tiroData.puntaje11?.cantidad ?? 0)
      );
      const totalPoints = tiroData.totalPoints ?? 0;
      const mCount = tiroData.puntajeM?.cantidad ?? 0;
      const goodCount = (tiroData.puntaje10?.cantidad ?? 0) + (tiroData.puntaje11?.cantidad ?? 0);
      const missPct = totalAttempts > 0 ? ((mCount / totalAttempts) * 100) : 0;
      const goodPct = totalAttempts > 0 ? ((goodCount / totalAttempts) * 100) : 0;

      // determinar mejor rango (corta/media/larga) por 10+11
      const rangeGood = { corta:0, media:0, larga:0 };
      const [cMin,cMax] = tiroData.distanciaCorta ?? [null,null];
      const [mMin,mMax] = tiroData.distanciaMedia ?? [null,null];
      const [lMin,lMax] = tiroData.distanciaLarga ?? [null,null];
      const getRange = (d) => {
        if (d==null) return null;
        const n = Number(d);
        if (!Number.isFinite(n)) return null;
        if (cMin!=null && cMax!=null && n >= cMin && n < cMax) return 'corta';
        if (mMin!=null && mMax!=null && n >= mMin && n < mMax) return 'media';
        return 'larga';
      };

      // recorrer disparos y contar 10/11 por rango
      Object.values(tiroData.arquero || {}).forEach(entry => {
        const estacion = Number(entry.estacion) || null;
        const meta = tiroData.estaciones && estacion ? tiroData.estaciones[estacion] : null;
        const dist = meta?.distancia ?? null;
        const rng = getRange(dist) || 'larga';
        [entry.disparo1, entry.disparo2].forEach(sh => {
          const v = sh === undefined || sh === null ? null : (typeof sh === 'string' ? sh : String(sh));
          if (v === '10' || v === '11' || v === 10 || v === 11) rangeGood[rng] += 1;
        });
      });

      // elegir mejor rango
      const bestRange = Object.entries(rangeGood).reduce((best, cur) => cur[1] > best[1] ? cur : best, ['corta',0])[0];

      // textos breves
      const posParts = [];
      posParts.push(`Puntos totales: ${totalPoints}.`);
      if (goodCount > 0) posParts.push(`Buen porcentaje de tiros altos: ${goodCount} (${goodPct.toFixed(1)}%).`);
      else posParts.push(`Pocos tiros 10/11 (${goodPct.toFixed(1)}%).`);
      if (bestRange) posParts.push(`Mejor desempeño en rango: ${bestRange}.`);
      positiveEl.textContent = posParts.join(' ');

      const improvParts = [];
      if (missPct > 8) improvParts.push(`Reducir las faltas ('M'): actualmente ${mCount} (${missPct.toFixed(1)}%).`);
      else improvParts.push(`Baja tasa de faltas (${missPct.toFixed(1)}%).`);
      // sugerir trabajar rangos con bajo conteo de 10/11
      const rangesOrder = ['corta','media','larga'];
      const lowRange = rangesOrder.reduce((low, r) => (rangeGood[r] < rangeGood[low] ? r : low), 'corta');
      if (lowRange) improvParts.push(`Trabajar precisión en rango ${lowRange} (menos tiros de 10/11).`);
      improvParts.push('Mejorar consistencia en entregas largas y apuntado en dianas altas.');
      improveEl.textContent = improvParts.join(' ');

     // --- Comparación entre primera y segunda vuelta ---
     if (vueltaEl) {
       let firstPoints = 0, secondPoints = 0;
       let firstAttempts = 0, secondAttempts = 0;
       let firstMiss = 0, secondMiss = 0;
       let firstGood = 0, secondGood = 0;
       // para detectar inicio/final dentro de cada vuelta
       let fStart = 0, fEnd = 0, sStart = 0, sEnd = 0;

       Object.entries(tiroData.arquero || {}).forEach(([k, entry]) => {
         const idx = Number(k);
         const pos = ((idx - 1) % 12) + 1; // 1..12
         const isFirst = idx <= 12;
         const shots = [entry.disparo1, entry.disparo2];
         shots.forEach(sh => {
           if (sh === undefined || sh === null) return;
           const sval = (sh === 'M') ? 0 : (Number(sh) || 0);
           const isMiss = (String(sh) === 'M' || String(sh) === 'm');
           const isGood = (String(sh) === '10' || String(sh) === '11' || sh === 10 || sh === 11);
           if (isFirst) {
             firstPoints += sval;
             firstAttempts += 1;
             if (isMiss) firstMiss += 1;
             if (isGood) firstGood += 1;
             if (pos <= 6) fStart += sval; else fEnd += sval;
           } else {
             secondPoints += sval;
             secondAttempts += 1;
             if (isMiss) secondMiss += 1;
             if (isGood) secondGood += 1;
             if (pos <= 6) sStart += sval; else sEnd += sval;
           }
         });
       });

       const compare = firstPoints === secondPoints
         ? `Puntuación similar entre vueltas: ${firstPoints} pts en la 1ª y ${secondPoints} pts en la 2ª.`
         : (firstPoints > secondPoints
           ? `Mejor en la primera vuelta (${firstPoints} pts) vs segunda (${secondPoints} pts).`
           : `Mejor en la segunda vuelta (${secondPoints} pts) vs primera (${firstPoints} pts).`);

       const trendFirst = fEnd > fStart ? 'Mejoró hacia el final de la 1ª vuelta.' : (fEnd < fStart ? 'Rendimiento bajó hacia el final de la 1ª vuelta.' : 'Rendimiento estable en la 1ª vuelta.');
       const trendSecond = sEnd > sStart ? 'Mejoró hacia el final de la 2ª vuelta.' : (sEnd < sStart ? 'Rendimiento bajó hacia el final de la 2ª vuelta.' : 'Rendimiento estable en la 2ª vuelta.');

       vueltaEl.textContent = `${compare} ${trendFirst} ${trendSecond}`;
     }

    })();

    (function renderScoreLine(){
      const svg = document.getElementById('scoreLineSvg');
      if (!svg) return;

      // Build shot sequence based on arquero order (keeps mapping to estacion & animal)
      const shotMetas = [];
      const arqueroKeys = Object.keys(tiroData.arquero || {}).map(k=>Number(k)).sort((a,b)=>a-b);
      arqueroKeys.forEach(k=>{
        const e = tiroData.arquero[k] || {};
        const station = Number(e.estacion) || (((k-1)%12)+1);
        const meta = (tiroData.estaciones && tiroData.estaciones[station]) || {};
        const animal = meta.animal && meta.animal.tipo ? String(meta.animal.tipo) : '—';
        const s1 = e.disparo1 !== undefined ? e.disparo1 : null;
        const s2 = e.disparo2 !== undefined ? e.disparo2 : null;
        shotMetas.push({station, animal, raw: s1});
        shotMetas.push({station, animal, raw: s2});
      });

      const shots = shotMetas.filter(s => s.raw !== undefined && s.raw !== null);

      const safeValLocal = v => (v === 'M' || v === 'm' ? 0 : (Number(v) || 0));
      const n = shots.length || 1;

      // cumulative obtained and perfect
      const obtained = [];
      const perfect = [];
      let acc = 0;
      for (let i=0;i<n;i++){
        const v = safeValLocal(shots[i].raw);
        acc += v;
        obtained.push(acc);
        perfect.push(11*(i+1));
      }

      // AGRANDADO: dimensiones internas acorde al viewBox ampliado
      const padding = {left:50,right:30,top:30,bottom:50};
      const W = 1200; const H = 340;
      const innerW = W - padding.left - padding.right;
      const innerH = H - padding.top - padding.bottom;
      const maxY = Math.max(perfect[perfect.length-1] || 11, Math.max(...obtained,0)) || 1;

      const xAt = (i) => padding.left + ( (n===1) ? innerW/2 : (i/(n-1))*innerW );
      const yAt = (v) => padding.top + (1 - (v / maxY))*innerH;

      // build polyline points
      const perfPoints = perfect.map((v,i)=> `${xAt(i)},${yAt(v)}`).join(' ');
      const obtPoints = obtained.map((v,i)=> `${xAt(i)},${yAt(v)}`).join(' ');

      // clear svg
      while(svg.firstChild) svg.removeChild(svg.firstChild);

      const ns = 'http://www.w3.org/2000/svg';

      // axes
      const axisX = document.createElementNS(ns,'line');
      axisX.setAttribute('x1',padding.left); axisX.setAttribute('y1',H-padding.bottom);
      axisX.setAttribute('x2',W-padding.right); axisX.setAttribute('y2',H-padding.bottom);
      axisX.setAttribute('stroke','rgba(255,255,255,0.06)');
      axisX.setAttribute('stroke-width','1');
      svg.appendChild(axisX);

      const axisY = document.createElementNS(ns,'line');
      axisY.setAttribute('x1',padding.left); axisY.setAttribute('y1',padding.top);
      axisY.setAttribute('x2',padding.left); axisY.setAttribute('y2',H-padding.bottom);
      axisY.setAttribute('stroke','rgba(255,255,255,0.06)');
      axisY.setAttribute('stroke-width','1');
      svg.appendChild(axisY);

      // perfect polyline
      const perfPoly = document.createElementNS(ns,'polyline');
      perfPoly.setAttribute('points', perfPoints);
      perfPoly.setAttribute('class','chartPerf');
      svg.appendChild(perfPoly);

      // obtained polyline
      const obtPoly = document.createElementNS(ns,'polyline');
      obtPoly.setAttribute('points', obtPoints);
      obtPoly.setAttribute('fill','none');
      obtPoly.setAttribute('stroke', getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#06b6d4');
      obtPoly.setAttribute('stroke-width','3');
      obtPoly.setAttribute('stroke-linecap','round');
      obtPoly.setAttribute('stroke-linejoin','round');
      svg.appendChild(obtPoly);

      // area under obtained (subtle)
      const areaPath = document.createElementNS(ns,'path');
      const areaD = `M ${padding.left} ${H-padding.bottom} L ${obtPoints.split(' ').map(p=>p).join(' L ')} L ${W-padding.right} ${H-padding.bottom} Z`;
      areaPath.setAttribute('d', areaD);
      areaPath.setAttribute('fill','rgba(6,182,212,0.08)');
      svg.appendChild(areaPath);

      // draw point markers and tooltips (colored by shot value)
      const colorFor = (raw) => {
        const s = String(raw);
        if (s === 'M' || s === 'm') return '#ef4444';   // rojo
        if (s === '5') return '#f59e0b';               // amarillo/ámbar
        if (s === '8') return '#06b6d4';               // celeste
        if (s === '10') return '#60a5fa';              // violeta/azul
        if (s === '11') return '#34d399';              // verde
        return getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#06b6d4';
      };

      obtained.forEach((val,i)=>{
        const cx = xAt(i), cy = yAt(val);
        const circle = document.createElementNS(ns,'circle');
        circle.setAttribute('cx',cx);
        circle.setAttribute('cy',cy);
        circle.setAttribute('r',5);
        // determine raw shot for this index (shots array defined above)
        const raw = shots[i] && (shots[i].raw !== undefined ? shots[i].raw : null);
        const fill = colorFor(raw);
        circle.setAttribute('fill', fill);
        circle.setAttribute('stroke','rgba(0,0,0,0.25)');
        svg.appendChild(circle);

        const title = document.createElementNS(ns,'title');
        title.textContent = `Tiro ${i+1}: ${raw} — acumulado ${val}`;
        circle.appendChild(title);
      });

      // Y ticks and labels (3 ticks)
      for (let t=0;t<=3;t++){
        const vy = Math.round((maxY/3)*t);
        const y = yAt(vy);
        const lx = document.createElementNS(ns,'line');
        lx.setAttribute('x1',padding.left-6); lx.setAttribute('y1',y);
        lx.setAttribute('x2',padding.left); lx.setAttribute('y2',y);
        lx.setAttribute('stroke','rgba(255,255,255,0.06)');
        svg.appendChild(lx);
        const lbl = document.createElementNS(ns,'text');
        lbl.setAttribute('x',padding.left-10); lbl.setAttribute('y',y+4);
        lbl.setAttribute('text-anchor','end');
        lbl.setAttribute('font-size','11');
        lbl.setAttribute('fill','var(--muted)');
        lbl.textContent = vy;
        svg.appendChild(lbl);
      }

      // shot strip removed — chart now larger and uncluttered
    })();
  </script>
</body>
</html>